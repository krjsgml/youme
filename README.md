# ğŸ’¡ ë¹„ì „ì„ ì´ìš©í•œ ë¬¼ë¥˜ ë³´ì¡° ë¡œë´‡ YOUME

## 1. í”„ë¡œì íŠ¸ ê°œìš”

### 1-1. í”„ë¡œì íŠ¸ ì†Œê°œ
**í”„ë¡œì íŠ¸ ëª…** : ë¹„ì „ì„ ì´ìš©í•œ ë¬¼ë¥˜ ë³´ì¡° ë¡œë´‡ YOUME  
**í”„ë¡œì íŠ¸ ì •ì˜** : ì‘ì—…ìì˜ ì›€ì§ì„ì„ ì¶”ì í•˜ê³ , ë¬¼ë¥˜ ì ì¬Â·ìš´ë°˜Â·ì•ˆì „ ê´€ë¦¬ë¥¼ ìˆ˜í–‰í•˜ëŠ” AI ê¸°ë°˜ ìŠ¤ë§ˆíŠ¸ ë¬¼ë¥˜ ë³´ì¡° ë¡œë´‡ ì‹œìŠ¤í…œ

### 1-2. ê°œë°œ ë°°ê²½ ë° í•„ìš”ì„±
ë¬¼ë¥˜ì„¼í„° ë° ì‘ì—… í˜„ì¥ì—ì„œëŠ” ë°˜ë³µì ì¸ ìš´ë°˜ ì‘ì—…, ì¸ë ¥ ë¶€ì¡±, ì‘ì—…ì ì•ˆì „ ë¬¸ì œê°€ ì§€ì†ì ìœ¼ë¡œ ë°œìƒí•˜ê³  ìˆìŠµë‹ˆë‹¤. ê¸°ì¡´ì˜ ìˆ˜ë™ ì¥ë¹„(ì§€ê²Œì°¨Â·ìí‚¤ ë“±)ëŠ” ì‘ì—…ì ê°œì…ì´ í•„ìš”í•˜ë©° ì‚¬ê³  ìœ„í—˜ì´ ì¡´ì¬í•©ë‹ˆë‹¤.  
ë”°ë¼ì„œ **ì‘ì—…ìì˜ ì›€ì§ì„ì„ ì¶”ì í•˜ì—¬ ììœ¨ì ìœ¼ë¡œ ìš´ë°˜ì„ ì§€ì›í•˜ê³ , í—¬ë©§ ì°©ìš© ê°ì§€ ë° ì‘ê¸‰ ìƒí™© ëŒ€ì‘ì´ ê°€ëŠ¥í•œ AI ê¸°ë°˜ ë¬¼ë¥˜ ë³´ì¡° ë¡œë´‡ì˜ í•„ìš”ì„±**ì´ ëŒ€ë‘ë˜ì—ˆìŠµë‹ˆë‹¤.

### 1-3. í”„ë¡œì íŠ¸ íŠ¹ì¥ì 
- OpenCV ê¸°ë°˜ ì‹¤ì‹œê°„ ê°ì²´ ì¸ì‹ ë° ì¶”ì 
- YOLOv8 í™œìš© í—¬ë©§ ì°©ìš© ì—¬ë¶€ ê°ì§€
- RFID ì¹´ë“œ ì¸ì¦ìœ¼ë¡œ ì‚¬ìš©ì ê¶Œí•œ ì œì–´
- MySQL ê¸°ë°˜ ë¬¼ë¥˜ ì •ë³´ ì €ì¥ ë° LCD ì¡°íšŒ
- Flutter + Flask ê¸°ë°˜ ê´€ë¦¬ì ì•± ì œê³µ
- ë¦¬ë‹ˆì–´ ì•¡ì¶”ì—ì´í„°ë¥¼ ì´ìš©í•œ ë¬¼ë¥˜ ì ì¬ ê¸°ëŠ¥
- Bluetooth/USART ê¸°ë°˜ ë¼ì¦ˆë² ë¦¬íŒŒì´-ì•„ë‘ì´ë…¸ í†µì‹ 

### 1-4. ì£¼ìš” ê¸°ëŠ¥
- âœ… ê°ì²´ ì¸ì‹ ë° ì¶”ì  (OpenCV, Tracker)
- âœ… ì‚¬ìš©ì ì¸ì¦ (RFID)
- âœ… í—¬ë©§ ì°©ìš© ì—¬ë¶€ íŒë‹¨ (YOLOv8)
- âœ… ì‘ê¸‰ ìƒí™© ì•Œë¦¼
- âœ… ë¬¼í’ˆ ìœ„ì¹˜ ì¡°íšŒ/ìˆ˜ì •/ì €ì¥ (MySQL + LCD)
- âœ… ì•± ê¸°ë°˜ ë¬¼ë¥˜ ê´€ë¦¬ (Flutter + Flask)
- âœ… ë¦¬ë‹ˆì–´ ì•¡ì¶”ì—ì´í„° ì ì¬ ê¸°ëŠ¥
- âœ… Bluetooth / USART í†µì‹ 

### 1-5. ê¸°ëŒ€ íš¨ê³¼ ë° í™œìš© ë¶„ì•¼
**ê¸°ëŒ€ íš¨ê³¼**
- ì‘ì—…ì ì•ˆì „ í™•ë³´ ë° ì‚°ì—…ì¬í•´ ê°ì†Œ
- ë¬¼ë¥˜ íš¨ìœ¨ ì¦ëŒ€ ë° ìë™í™” ìˆ˜ì¤€ í–¥ìƒ
- ì‘ì—…ìì˜ í”¼ë¡œë„ ë° ì¸ë ¥ ë¶€ë‹´ ê°ì†Œ
- ìŠ¤ë§ˆíŠ¸ ë¬¼ë¥˜Â·ìŠ¤ë§ˆíŠ¸íŒ©í† ë¦¬ ì—°ê³„ ê°€ëŠ¥ì„±

**í™œìš© ë¶„ì•¼**
- ë¬¼ë¥˜ì„¼í„° ë° ì°½ê³ 
- ëŒ€í˜• ë§ˆíŠ¸ ë° ìœ í†µë§¤ì¥
- ê³µì¥ ë‚´ ë¶€í’ˆ ì´ì†¡
- ê±´ì„¤ í˜„ì¥
- ìë™í™” ë¬¼ë¥˜ ì„¤ë¹„ ì‚°ì—…

### 1-6. ê¸°ìˆ  ìŠ¤íƒ
**í”„ë¡ íŠ¸ì—”ë“œ / ì•±**  
- Flutter

**ë°±ì—”ë“œ**  
- Flask (Python)

**AI / Vision**  
- OpenCV  
- YOLOv8  
- HaarCascade  
- Tracker (KCF ë“±)

**ë°ì´í„°ë² ì´ìŠ¤**  
- MySQL

**ì„ë² ë””ë“œ & í†µì‹ **  
- Raspberry Pi  
- Arduino  
- Bluetooth / USART  
- PIDì œì–´

**ì–¸ì–´**  
- Python, Java, SQL, C

---

## 2. íŒ€ì› ì†Œê°œ
| ì´ë¦„ | ì—­í•  | ë‹´ë‹¹ |
|------|------|------|
| ê¹€ê±´í¬ | íŒ€ì¥ | Tracking Â· Flutter Â· Flask Â· MySQL |
| ì´ìœ ë‚˜ | SW |  í—¬ë©§ ê°ì§€ |
| ì •ì„í˜¸ | SW / HW | ì‘ê¸‰ìƒí™© ê°ì§€ Â· HW ì„¤ê³„ |
| ìœ¤ì¤€ì„œ | ëª¨í„°ì œì–´ / HW | ì„¼ì„œ Â· íšŒë¡œ Â· ëª¨í„° ì œì–´ |
| í•˜ê²½ìš± | ë©˜í†  | ê¸°ìˆ  ìë¬¸ ë° í”¼ë“œë°± |

---

## 3. ì‹œìŠ¤í…œ êµ¬ì„±ë„
### âœ… ì„œë¹„ìŠ¤ êµ¬ì„±ë„
<img width="643" height="350" alt="Image" src="https://github.com/user-attachments/assets/653d9efc-6243-427b-80ba-805a93d21362" />

### âœ… í•˜ë“œì›¨ì–´ êµ¬ì„±ë„
<img width="643" height="363" alt="Image" src="https://github.com/user-attachments/assets/6d769523-056e-43de-8b32-1358f9a1e5de" />

## 4. ì‘í’ˆ ì†Œê°œì˜ìƒ
[![YOUME ì‹œì—° ì˜ìƒ](https://github.com/user-attachments/assets/d0cba4cf-4ef0-44c3-83c9-4def7aaa6331)](https://www.youtube.com/watch?v=2qM_VF10ME4)

---

## 5. í•µì‹¬ ì†ŒìŠ¤ì½”ë“œ
Â· ì†ŒìŠ¤ì½”ë“œ ì„¤ëª… : HaarCascadeì™€ Tracker APIë¥¼ ì´ìš©í•˜ì—¬ Tracking ê¸°ëŠ¥ì„ êµ¬í˜„

```python
class Tracking(QThread):
    result_signal = pyqtSignal(QPixmap)  # QPixmap ì „ì†¡ (ê¸°ì¡´ API ìœ ì§€)

    def __init__(self):
        super().__init__()
        # ì™¸ë¶€ ìŠ¤ë ˆë“œ
        self.bluetooth_thread = get_bluetooth()
        self.fall_detect_thread = Falldetect()
        self.helmet_detect_thread = HelmetDetect()

        # ì¹´ë©”ë¼ëŠ” ë³„ë„ ìŠ¤ë ˆë“œë¡œ ë¶„ë¦¬
        self.camera_thread = CameraThread(cam_indices=[2, 0], width=640, height=400)
        self.camera_thread.frame_signal.connect(self.on_camera_frame)

        # ìƒíƒœ í”Œë˜ê·¸
        self.running = False
        self.tracking = False
        self.detects = []
        self.prev_pos = None
        self.stop_track = 0
        self.stop_dc_motor_flag = False
        self.stop_dc_no_helmet_Flag = False
        self.helmet_frame_count = 0
        self.emergency_state = False

        # ROI/íŠ¸ë˜ì»¤
        self.tracker = create_kcf_tracker()
        self._frame_mutex = QMutex()
        self.frame = None  # ìµœì‹  í”„ë ˆì„(ì›ë³¸ numpy ë°°ì—´)
        self.cam_indices = [2, 0]
        self.current_index = 0

        # Haarcascade
        self.cascade = cv2.CascadeClassifier("/home/jsh/youme/haarcascade/haarcascade_frontalface_default.xml")

        # UI update rate limiting
        self.max_update_fps = 10.0
        self._last_update_time = 0.0

    # ---------- Camera -> Tracking frame ìˆ˜ì‹  ìŠ¬ë¡¯ ----------
    def on_camera_frame(self, frame):
        # camera threadì—ì„œ ì „ë‹¬ë˜ëŠ” ì›ë³¸ í”„ë ˆì„ì„ ì•ˆì „í•˜ê²Œ ì €ì¥
        with QMutexLocker(self._frame_mutex):
            # shallow copy -> ì´í›„ í•„ìš” ì‹œ .copy() ìˆ˜í–‰
            self.frame = frame.copy()

    # ---------- run: ë©”ì¸ ë£¨í”„ ----------
    def run(self):
        # ì‹œì‘
        self.running = True

        # ì¹´ë©”ë¼ ìŠ¤ë ˆë“œ ì‹œì‘
        if not self.camera_thread.isRunning():
            self.camera_thread.start()

        # ë³´ì¡° ê°ì§€ ìŠ¤ë ˆë“œ ì‹œì‘(í—¬ë©§)
        if not self.helmet_detect_thread.isRunning():
            self.helmet_detect_thread.start()

        while self.running:
            local = None
            with QMutexLocker(self._frame_mutex):
                if self.frame is not None:
                    local = self.frame.copy()

            if local is None:
                self.msleep(5)
                continue
            
            frame = local
            self.helmet_frame_count += 1
            if self.helmet_frame_count % 5 == 0:
                self.helmet_detect_thread.update_frame(frame)

            if self.emergency_state:
                self.camera_thread.switch_camera(1)
                self.fall_detect_thread.update_frame(frame)
                cv2.putText(frame, "emergency situation!", (10, 90),
                            cv2.FONT_HERSHEY_SIMPLEX, 0.8, (0, 0, 255), 2)

            else:
                if self.helmet_detect_thread.helmet_detected:
                    self.stop_dc_motor_flag = False
                    self.stop_dc_no_helmet_Flag = False

                    if not self.tracking:
                        gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)
                        self.detects = self.cascade.detectMultiScale(gray, scaleFactor=1.1, minNeighbors=5)
                        for (x, y, w, h) in self.detects:
                            cv2.rectangle(frame, (x, y), (x + w, y + h), (255, 0, 0), 2)

                        cv2.putText(frame, "Click a box to track", (10, 30),
                                    cv2.FONT_HERSHEY_SIMPLEX, 0.8, (0, 0, 255), 2)
                    else:
                        try:
                            success, box = self.tracker.update(frame)
                        except Exception:
                            self.tracker = create_mosse_tracker()
                            success = False
                            box = None

                        if success and box is not None:
                            x, y, w, h = [int(v) for v in box]
                            cv2.rectangle(frame, (x, y), (x + w, y + h), (0, 255, 0), 2)
                            cv2.putText(frame, "Tracking...", (x, y - 10),
                                        cv2.FONT_HERSHEY_SIMPLEX, 0.6, (0, 255, 0), 2)

                            face_center = x + w // 2
                            left_bound = frame.shape[1] // 3
                            right_bound = 2 * frame.shape[1] // 3

                            if face_center < left_bound:
                                pos = 'l'
                            elif face_center > right_bound:
                                pos = 'r'
                            else:
                                pos = 'c'

                            if pos != self.prev_pos:
                                self.bluetooth_thread.send_data(pos)
                                self.prev_pos = pos

                            self.stop_track = 0
                        else:
                            cv2.putText(frame, "Tracking failure", (10, 60),
                                        cv2.FONT_HERSHEY_SIMPLEX, 0.8, (0, 0, 255), 2)

                            if not self.stop_dc_motor_flag:
                                self.bluetooth_thread.send_data('s')
                                self.stop_dc_motor_flag = True

                            self.stop_track += 1
                            if self.stop_track >= 50:
                                if not self.fall_detect_thread.isRunning():
                                    self.fall_detect_thread.start()
                                print("dc motor stop")
                                self.emergency_state = True
                                self.helmet_detect_thread.emergency_state = True

                else:
                    if not self.stop_dc_no_helmet_Flag:
                        self.bluetooth_thread.send_data('s')
                        self.stop_dc_no_helmet_Flag = True

                    self.tracking = False
                    self.tracker = create_kcf_tracker()
                    self.detects = []
                    cv2.putText(frame, "Please wear a helmet.", (10, 60),
                                cv2.FONT_HERSHEY_SIMPLEX, 0.8, (0, 0, 255), 2)

            now = time.time()
            if now - self._last_update_time >= (1.0 / self.max_update_fps):
                self._last_update_time = now
                self.handle_tracking_result(frame)

            self.msleep(5)

        # ë£¨í”„ ì¢…ë£Œ ì‹œ ì •ë¦¬
        self.camera_thread.stop()
        # ë³´ì¡° ìŠ¤ë ˆë“œ ì¤‘ì§€
        try:
            self.helmet_detect_thread.stop()
        except Exception:
            pass
        try:
            self.fall_detect_thread.stop()
        except Exception:
            pass
